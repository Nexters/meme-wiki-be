<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ˆ ê´€ë¦¬ - ë°ˆìœ„í‚¤ ê´€ë¦¬ì</title>
    <link href="/webjars/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            border: none;
            font-weight: 600;
            padding: 1.5rem;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .btn-danger {
            border-radius: 8px;
            font-weight: 600;
        }
        .form-control, .form-select {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .table {
            border-radius: 10px;
            overflow: hidden;
        }
        .table thead th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: 600;
        }
        .meme-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        .text-truncate-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.4;
            max-height: calc(1.4em * 2);
        }
        .badge {
            font-size: 0.75rem;
            padding: 0.5rem 0.75rem;
            border-radius: 20px;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .emoji {
            font-size: 2rem;
        }
        .loading {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                ğŸ­ ë°ˆìœ„í‚¤ ê´€ë¦¬ì
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link text-white me-3" href="/admin/memes">ğŸ“ ì „ì²´ ë°ˆ ê´€ë¦¬</a>
                <a class="nav-link text-white me-3" href="/admin/memes/review">ğŸ” ê²€í†  ëŒ€ê¸°</a>
                <a class="nav-link text-white me-3" href="/admin/memes/stats">ğŸ“Š ì¸ê¸° ë°ˆ í†µê³„</a>
                <span class="navbar-text me-3">
                    ğŸ‘‹ ê´€ë¦¬ìë‹˜, ì•ˆë…•í•˜ì„¸ìš”!
                </span>
                <a class="btn btn-outline-light btn-sm" th:href="@{/admin/logout}">
                    ğŸšª ë¡œê·¸ì•„ì›ƒ
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle"></i>
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stats-card">
            <div class="row text-center">
                <div class="col-md-4">
                    <div class="emoji">ğŸ“Š</div>
                    <h3 th:text="${totalCount}">0</h3>
                    <p class="mb-0">ì´ ë°ˆ ê°œìˆ˜</p>
                </div>
                <div class="col-md-4">
                    <div class="emoji">ğŸ†•</div>
                    <h3>ê´€ë¦¬</h3>
                    <p class="mb-0">ë°ˆ ì¶”ê°€/ì‚­ì œ</p>
                </div>
                <div class="col-md-4">
                    <a href="/admin/memes/stats" class="text-decoration-none text-white">
                        <div class="emoji">ğŸ“Š</div>
                        <h3>ì¸ê¸° ë°ˆ</h3>
                        <p class="mb-0">í†µê³„ ì¡°íšŒ</p>
                    </a>
                </div>
            </div>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ ê°€ì´ë“œ -->
        <div class="row mb-4" th:if="${not #lists.isEmpty(categories)}">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ğŸ“‚ í˜„ì¬ ë“±ë¡ëœ ì¹´í…Œê³ ë¦¬</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div th:each="category : ${categories}" class="col-md-3 mb-3">
                                <div class="p-3 bg-light rounded text-center">
                                    <img th:if="${category.imgUrl}" 
                                         th:src="${category.imgUrl}" 
                                         th:alt="${category.name}"
                                         class="mb-2"
                                         style="width: 40px; height: 40px; object-fit: cover; border-radius: 50%;">
                                    <h6 class="fw-bold text-primary" th:text="|ID: ${category.id}|">ID: 1</h6>
                                    <p class="mb-0 fw-bold" th:text="${category.name}">ì¹´í…Œê³ ë¦¬ëª…</p>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-info mb-0">
                            <small>
                                <strong>ğŸ’¡ íŒ:</strong> 
                                ìœ„ì˜ ì¹´í…Œê³ ë¦¬ IDë¥¼ ì°¸ê³ í•´ì„œ ë°ˆì— ì ì ˆí•œ ì¹´í…Œê³ ë¦¬ë¥¼ ì§€ì •í•´ì£¼ì„¸ìš”.
                                ë°ˆì˜ ì„±ê²©ê³¼ ì‚¬ìš© ë§¥ë½ì— ë”°ë¼ ì ì ˆí•œ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- ìƒˆ ë°ˆ ì¶”ê°€ í¼ -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ğŸ†• ìƒˆ ë°ˆ ì¶”ê°€</h5>
                    </div>
                    <div class="card-body">
                        <form th:action="@{/admin/memes}" method="post" id="addMemeForm" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="title" class="form-label fw-bold">ë°ˆ ì œëª© *</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="title" 
                                       name="title" 
                                       placeholder="ì˜ˆ: ì˜¤íˆë ¤ ì¢‹ì•„"
                                       required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="origin" class="form-label fw-bold">ì¶œì²˜/ìœ ë˜ *</label>
                                <textarea class="form-control" 
                                          id="origin" 
                                          name="origin" 
                                          rows="2"
                                          placeholder="ì˜ˆ: ë¬´í•œë„ì „ ë°•ëª…ìˆ˜"
                                          required></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="usageContext" class="form-label fw-bold">ì‚¬ìš© ë§¥ë½ *</label>
                                <textarea class="form-control" 
                                          id="usageContext" 
                                          name="usageContext" 
                                          rows="3"
                                          placeholder="ì–¸ì œ, ì–´ë–¤ ìƒí™©ì—ì„œ ì‚¬ìš©í•˜ëŠ”ì§€ ìì„¸íˆ ì„¤ëª…"
                                          required></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="hashtags" class="form-label fw-bold">í•´ì‹œíƒœê·¸ *</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="hashtags" 
                                       name="hashtags" 
                                       placeholder="ì˜ˆ: #í—ˆë¬´ #ë§í•¨ #í­ë§ #ë¬´í•œë„ì „"
                                       required>
                            </div>
                            
                            <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
                            <div class="mb-3" th:if="${not #lists.isEmpty(categories)}">
                                <label for="categoryIds" class="form-label fw-bold">ì¹´í…Œê³ ë¦¬ ì„ íƒ</label>
                                <div class="card border-light bg-light">
                                    <div class="card-body p-3">
                                        <div class="row">
                                            <div th:each="category : ${categories}" class="col-6 mb-2">
                                                <div class="form-check">
                                                    <input class="form-check-input" 
                                                           type="checkbox" 
                                                           th:id="|category_${category.id}|"
                                                           name="categoryIds" 
                                                           th:value="${category.id}">
                                                    <label class="form-check-label d-flex align-items-center" 
                                                           th:for="|category_${category.id}|">
                                                        <img th:if="${category.imgUrl}" 
                                                             th:src="${category.imgUrl}" 
                                                             th:alt="${category.name}"
                                                             class="me-2"
                                                             style="width: 20px; height: 20px; object-fit: cover; border-radius: 50%;">
                                                        <small th:text="|${category.name} (ID: ${category.id})|">ì¹´í…Œê³ ë¦¬ëª… (ID: 1)</small>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-text">
                                            <small>â€» í•´ë‹¹í•˜ëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš” (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ/URL ì„ íƒ -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">ì´ë¯¸ì§€ *</label>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="card border-light bg-light">
                                            <div class="card-body p-3">
                                                <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜µì…˜ -->
                                                <div class="mb-3">
                                                    <label for="imageFile" class="form-label">ğŸ“ íŒŒì¼ ì—…ë¡œë“œ (ì¶”ì²œ)</label>
                                                    <input type="file" 
                                                           class="form-control" 
                                                           id="imageFile" 
                                                           name="imageFile" 
                                                           accept="image/*"
                                                           onchange="toggleImageOptions(this)">
                                                    <div class="form-text">
                                                        <small>ì§€ì› í˜•ì‹: JPG, PNG, GIF, WebP (ìµœëŒ€ 10MB)</small>
                                                    </div>
                                                </div>
                                                
                                                <div class="text-center mb-2">
                                                    <span class="badge bg-secondary">ë˜ëŠ”</span>
                                                </div>
                                                
                                                <!-- URL ì…ë ¥ ì˜µì…˜ -->
                                                <div class="mb-0">
                                                    <label for="imgUrl" class="form-label">ğŸ”— ì´ë¯¸ì§€ URL</label>
                                                    <input type="url" 
                                                           class="form-control" 
                                                           id="imgUrl" 
                                                           name="imgUrl" 
                                                           placeholder="https://example.com/image.jpg"
                                                           onchange="toggleImageOptions(this)">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="trendPeriod" class="form-label fw-bold">ìœ í–‰ ì‹œê¸°</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="trendPeriod" 
                                       name="trendPeriod" 
                                       placeholder="ì˜ˆ: 2020">
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <span class="loading spinner-border spinner-border-sm me-2"></span>
                                    â• ë°ˆ ì¶”ê°€í•˜ê¸°
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ë°ˆ ë¦¬ìŠ¤íŠ¸ -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0">ğŸ“ ë°ˆ ë¦¬ìŠ¤íŠ¸</h5>
                            <span class="badge bg-light text-dark" id="memeCount" th:text="|ì´ ${totalCount}ê°œ|">ì´ 0ê°œ</span>
                        </div>
                        
                        <!-- ê²€ìƒ‰ ë° í•„í„° ì˜µì…˜ -->
                        <div class="row g-2">
                            <div class="col-md-5">
                                <div class="input-group">
                                    <span class="input-group-text bg-white">ğŸ”</span>
                                    <input type="text" 
                                           class="form-control" 
                                           id="searchInput" 
                                           placeholder="ì œëª©, ì¶œì²˜, ì‚¬ìš©ë§¥ë½, í•´ì‹œíƒœê·¸ë¡œ ê²€ìƒ‰...">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="categoryFilter">
                                    <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                                    <option value="ë¯¸ë¶„ë¥˜">ë¯¸ë¶„ë¥˜</option>
                                    <option th:each="category : ${categories}" 
                                            th:value="${category.name}" 
                                            th:text="${category.name}">ì¹´í…Œê³ ë¦¬</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <div class="form-check d-flex align-items-center h-100 ps-3">
                                    <input class="form-check-input me-2" 
                                           type="checkbox" 
                                           id="approvalFilter"
                                           th:checked="${showApprovedOnly}"
                                           onchange="toggleApprovalFilter()">
                                    <label class="form-check-label fw-bold text-nowrap" 
                                           for="approvalFilter"
                                           style="font-size: 0.9rem;">
                                        ìŠ¹ì¸ëœ ë°ˆë§Œ ë³´ê¸°
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <button type="button" class="btn btn-outline-secondary w-100" id="clearFilters">
                                    ğŸ”„ ì´ˆê¸°í™”
                                </button>
                            </div>
                            <div class="col-md-2">
                                <button type="button" class="btn btn-danger w-100" id="deleteSelectedBtn" disabled>
                                    ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        
                        <!-- ì¼ê´„ ì‚­ì œ í¼ -->
                        <form id="deleteMultipleForm" th:action="@{/admin/memes/delete-multiple}" method="post" style="display: none;">
                            <input type="hidden" name="memeIds" id="selectedMemeIds">
                        </form>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th width="3%">
                                            <input type="checkbox" class="form-check-input" id="selectAllCheckbox">
                                        </th>
                                        <th width="5%">ID</th>
                                        <th width="8%">ì´ë¯¸ì§€</th>
                                        <th width="12%">ì œëª©</th>
                                        <th width="12%">ì¶œì²˜</th>
                                        <th width="17%">ì‚¬ìš© ë§¥ë½</th>
                                        <th width="12%">ì¹´í…Œê³ ë¦¬</th>
                                        <th width="10%">í•´ì‹œíƒœê·¸</th>
                                        <th width="8%">ìƒíƒœ</th>
                                        <th width="12%">ì•¡ì…˜</th>
                                    </tr>
                                </thead>
                                <tbody id="memeTableBody">
                                    <tr th:if="${#lists.isEmpty(memes)}">
                                        <td colspan="10" class="text-center py-5 text-muted">
                                            <div class="emoji">ğŸ˜…</div>
                                            <p class="mb-0">ì•„ì§ ë“±ë¡ëœ ë°ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                        </td>
                                    </tr>
                                    
                                    <tr th:each="meme : ${memes}">
                                        <td class="align-middle">
                                            <input type="checkbox" 
                                                   class="form-check-input meme-checkbox" 
                                                   th:value="${meme.id}">
                                        </td>
                                        <td class="align-middle">
                                            <span class="badge bg-secondary" th:text="${meme.id}">1</span>
                                        </td>
                                        <td class="align-middle">
                                            <img th:if="${meme.imgUrl}" 
                                                 th:src="${meme.imgUrl}" 
                                                 th:alt="${meme.title}"
                                                 class="meme-image"
                                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0zMCAyMEMyNS4wMzc1IDIwIDIxIDI0LjAzNzUgMjEgMjlDMjEgMzMuOTYyNSAyNS4wMzc1IDM4IDMwIDM4QzM0Ljk2MjUgMzggMzkgMzMuOTYyNSAzOSAyOUMzOSAyNC4wMzc1IDM0Ljk2MjUgMjAgMzAgMjBaIiBzdHJva2U9IiM5Q0EzQUYiIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4K'">
                                            <div th:unless="${meme.imgUrl}" class="meme-image d-flex align-items-center justify-content-center bg-light">
                                                <span class="text-muted">ğŸ–¼ï¸</span>
                                            </div>
                                        </td>
                                        <td class="align-middle">
                                            <strong th:text="${meme.title}">ë°ˆ ì œëª©</strong>
                                        </td>
                                        <td class="align-middle">
                                            <div class="text-truncate-2" th:text="${meme.origin}">ì¶œì²˜</div>
                                        </td>
                                        <td class="align-middle">
                                            <div class="text-truncate-2" th:text="${meme.usageContext}">ì‚¬ìš© ë§¥ë½</div>
                                        </td>
                                        <td class="align-middle">
                                            <div th:if="${memeCategoryMap[meme.id] != null and not #lists.isEmpty(memeCategoryMap[meme.id])}">
                                                <span th:each="categoryName, iterStat : ${memeCategoryMap[meme.id]}" 
                                                      class="badge bg-primary me-1 mb-1"
                                                      th:text="${categoryName}">ì¹´í…Œê³ ë¦¬</span>
                                            </div>
                                            <span th:unless="${memeCategoryMap[meme.id] != null and not #lists.isEmpty(memeCategoryMap[meme.id])}" 
                                                  class="text-muted small">ë¯¸ë¶„ë¥˜</span>
                                        </td>
                                        <td class="align-middle">
                                            <small class="text-muted" th:text="${meme.hashtags}">í•´ì‹œíƒœê·¸</small>
                                        </td>
                                        <td class="align-middle">
                                            <span th:if="${meme.flag != null and meme.flag.name() == 'NORMAL'}" 
                                                  class="badge bg-success">âœ… ìŠ¹ì¸</span>
                                            <span th:if="${meme.flag != null and meme.flag.name() == 'ABNORMAL'}" 
                                                  class="badge bg-warning text-dark">â³ ê²€í† ëŒ€ê¸°</span>
                                            <span th:unless="${meme.flag != null}" 
                                                  class="badge bg-secondary">ë¯¸ì •</span>
                                        </td>
                                        <td class="align-middle">
                                            <div class="btn-group-vertical gap-1" role="group">
                                                <!-- ìŠ¹ì¸/ë°˜ë ¤ ë²„íŠ¼ -->
                                                <div th:if="${meme.flag != null and meme.flag.name() == 'ABNORMAL'}" class="btn-group" role="group">
                                                    <button type="button" 
                                                            class="btn btn-success btn-sm"
                                                            th:onclick="|approveMeme(${meme.id})|"
                                                            title="ìŠ¹ì¸ (ì •ìƒìœ¼ë¡œ ë³€ê²½)">
                                                        âœ…
                                                    </button>
                                                </div>
                                                <div th:if="${meme.flag != null and meme.flag.name() == 'NORMAL'}" class="btn-group" role="group">
                                                    <button type="button" 
                                                            class="btn btn-warning btn-sm"
                                                            th:onclick="|rejectMeme(${meme.id})|"
                                                            title="ë°˜ë ¤ (ê²€í† ëŒ€ê¸°ë¡œ ë³€ê²½)">
                                                        âš ï¸
                                                    </button>
                                                </div>
                                                
                                                <!-- ê¸°ì¡´ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ -->
                                                <div class="btn-group" role="group">
                                                    <a th:href="@{/admin/memes/{id}/edit(id=${meme.id})}" 
                                                       class="btn btn-primary btn-sm"
                                                       title="ìˆ˜ì •">
                                                        âœï¸
                                                    </a>
                                                    <form th:action="@{/admin/memes/{id}/delete(id=${meme.id})}" 
                                                          method="post" 
                                                          style="display: inline;"
                                                          onsubmit="return confirm('ì •ë§ë¡œ ì´ ë°ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                                        <button type="submit" 
                                                                class="btn btn-danger btn-sm"
                                                                title="ì‚­ì œ">
                                                            ğŸ—‘ï¸
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/webjars/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ì´ë¯¸ì§€ ì˜µì…˜ í† ê¸€ í•¨ìˆ˜
        function toggleImageOptions(changedElement) {
            const imageFileInput = document.getElementById('imageFile');
            const imgUrlInput = document.getElementById('imgUrl');
            
            if (changedElement.id === 'imageFile' && changedElement.files.length > 0) {
                // íŒŒì¼ì´ ì„ íƒë˜ë©´ URL ì…ë ¥ ë¹„í™œì„±í™”
                imgUrlInput.value = '';
                imgUrlInput.disabled = true;
                imgUrlInput.style.backgroundColor = '#f8f9fa';
            } else if (changedElement.id === 'imgUrl' && changedElement.value.trim() !== '') {
                // URLì´ ì…ë ¥ë˜ë©´ íŒŒì¼ ì…ë ¥ ë¹„í™œì„±í™”
                imageFileInput.value = '';
                imageFileInput.disabled = true;
                imageFileInput.style.backgroundColor = '#f8f9fa';
            } else {
                // ê°’ì´ ë¹„ì–´ìˆìœ¼ë©´ ëª¨ë“  ì˜µì…˜ í™œì„±í™”
                imageFileInput.disabled = false;
                imgUrlInput.disabled = false;
                imageFileInput.style.backgroundColor = '';
                imgUrlInput.style.backgroundColor = '';
            }
        }
        
        // í¼ ì œì¶œ ì‹œ ë¡œë”© í‘œì‹œ ë° validation
        document.getElementById('addMemeForm').addEventListener('submit', function(e) {
            const imageFileInput = document.getElementById('imageFile');
            const imgUrlInput = document.getElementById('imgUrl');
            
            // ì´ë¯¸ì§€ ì—…ë¡œë“œë‚˜ URL ì¤‘ í•˜ë‚˜ëŠ” ë°˜ë“œì‹œ ìˆì–´ì•¼ í•¨
            if (!imageFileInput.files.length && !imgUrlInput.value.trim()) {
                e.preventDefault();
                alert('ì´ë¯¸ì§€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê±°ë‚˜ ì´ë¯¸ì§€ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return false;
            }
            
            const button = this.querySelector('button[type="submit"]');
            const loading = button.querySelector('.loading');
            
            button.disabled = true;
            loading.style.display = 'inline-block';
            button.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>ì—…ë¡œë“œ ì¤‘...';
        });
        
        // íŒŒì¼ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸° ë° í¬ê¸° ì²´í¬
        document.getElementById('imageFile').addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                // íŒŒì¼ í¬ê¸° ì²´í¬ (10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert('íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤!');
                    this.value = '';
                    return;
                }
                console.log('âœ… íŒŒì¼ ì„ íƒë¨:', file.name, '(' + (file.size / 1024 / 1024).toFixed(2) + 'MB)');
            }
        });
        
        // ì´ë¯¸ì§€ URL ì…ë ¥ ì‹œ ë¯¸ë¦¬ë³´ê¸°
        document.getElementById('imgUrl').addEventListener('input', function() {
            const url = this.value;
            if (url) {
                console.log('ğŸ”— Image URL:', url);
            }
        });
        
        // ìë™ ì•Œë¦¼ ìˆ¨ê¹€
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
        
        // í•„í„°ë§ ê¸°ëŠ¥
        const searchInput = document.getElementById('searchInput');
        const categoryFilter = document.getElementById('categoryFilter');
        const clearFiltersBtn = document.getElementById('clearFilters');
        const memeTableBody = document.getElementById('memeTableBody');
        const memeCount = document.getElementById('memeCount');
        
        let allRows = Array.from(memeTableBody.querySelectorAll('tr')).filter(row => 
            !row.querySelector('td[colspan]') // ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ í–‰ ì œì™¸
        );
        const totalCount = allRows.length;
        
        function filterMemes() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const selectedCategory = categoryFilter.value.toLowerCase().trim();
            
            let visibleCount = 0;
            
            allRows.forEach(row => {
                const title = row.cells[2].textContent.toLowerCase();
                const origin = row.cells[3].textContent.toLowerCase();
                const usageContext = row.cells[4].textContent.toLowerCase();
                const hashtags = row.cells[6].textContent.toLowerCase();
                const categoryCell = row.cells[5];
                
                // ì¹´í…Œê³ ë¦¬ ì •ë³´ ì¶”ì¶œ
                let rowCategories = [];
                const categoryBadges = categoryCell.querySelectorAll('.badge');
                if (categoryBadges.length > 0) {
                    categoryBadges.forEach(badge => {
                        rowCategories.push(badge.textContent.toLowerCase().trim());
                    });
                } else {
                    const uncategorizedSpan = categoryCell.querySelector('.text-muted');
                    if (uncategorizedSpan && uncategorizedSpan.textContent.includes('ë¯¸ë¶„ë¥˜')) {
                        rowCategories.push('ë¯¸ë¶„ë¥˜');
                    }
                }
                
                // ê²€ìƒ‰ì–´ í•„í„°ë§
                const matchesSearch = !searchTerm || 
                    title.includes(searchTerm) || 
                    origin.includes(searchTerm) || 
                    usageContext.includes(searchTerm) || 
                    hashtags.includes(searchTerm);
                
                // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
                const matchesCategory = !selectedCategory || 
                    rowCategories.some(cat => cat === selectedCategory);
                
                if (matchesSearch && matchesCategory) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            memeCount.textContent = `ì´ ${visibleCount}ê°œ`;
            
            // ê²°ê³¼ê°€ ì—†ì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
            const emptyRow = memeTableBody.querySelector('tr[colspan]');
            if (visibleCount === 0 && totalCount > 0) {
                if (!document.getElementById('noResultsRow')) {
                    const noResultsRow = document.createElement('tr');
                    noResultsRow.id = 'noResultsRow';
                    noResultsRow.innerHTML = `
                        <td colspan="10" class="text-center py-5 text-muted">
                            <div class="emoji">ğŸ”</div>
                            <p class="mb-0">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </td>
                    `;
                    memeTableBody.appendChild(noResultsRow);
                }
            } else {
                const noResultsRow = document.getElementById('noResultsRow');
                if (noResultsRow) {
                    noResultsRow.remove();
                }
            }
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        searchInput.addEventListener('input', filterMemes);
        categoryFilter.addEventListener('change', filterMemes);
        
        clearFiltersBtn.addEventListener('click', function() {
            searchInput.value = '';
            categoryFilter.value = '';
            
            // ìŠ¹ì¸ ìƒíƒœ ì²´í¬ë°•ìŠ¤ë„ ì´ˆê¸°í™” (ê¸°ë³¸ê°’ì¸ ìŠ¹ì¸ëœ ë°ˆë§Œ ë³´ê¸°ë¡œ)
            const checkbox = document.getElementById('approvalFilter');
            checkbox.checked = true;
            
            const url = new URL(window.location);
            url.searchParams.set('showApprovedOnly', 'true');
            window.location.href = url.toString();
        });
        
        // ì´ˆê¸° ë¡œë“œ ì‹œ ëª¨ë“  í–‰ í‘œì‹œ
        filterMemes();
        
        // ì„±ëŠ¥ ìµœì í™”ëœ ì²´í¬ë°•ìŠ¤ ê´€ë¦¬
        const selectAllCheckbox = document.getElementById('selectAllCheckbox');
        const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
        const deleteMultipleForm = document.getElementById('deleteMultipleForm');
        const selectedMemeIds = document.getElementById('selectedMemeIds');
        
        // Set ê¸°ë°˜ ì„ íƒëœ ë°ˆ ID ê´€ë¦¬
        const checkedMemeIds = new Set();
        
        // ë””ë°”ìš´ì‹± í•¨ìˆ˜
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // ì´ë²¤íŠ¸ ìœ„ì„: í…Œì´ë¸” ì „ì²´ì— ë‹¨ì¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('memeTableBody').addEventListener('change', function(e) {
            if (e.target.matches('.meme-checkbox')) {
                const memeId = e.target.value;
                if (e.target.checked) {
                    checkedMemeIds.add(memeId);
                } else {
                    checkedMemeIds.delete(memeId);
                }
                debouncedUpdateDeleteButton();
            }
        });
        
        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤
        selectAllCheckbox.addEventListener('change', function() {
            const memeCheckboxes = document.querySelectorAll('.meme-checkbox');
            const visibleCheckboxes = Array.from(memeCheckboxes).filter(checkbox => 
                checkbox.closest('tr').style.display !== 'none'
            );
            
            checkedMemeIds.clear(); // ê¸°ì¡´ ì„ íƒ ì´ˆê¸°í™”
            
            visibleCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
                if (this.checked) {
                    checkedMemeIds.add(checkbox.value);
                }
            });
            
            updateDeleteButtonOptimized();
        });
        
        // ìµœì í™”ëœ ì„ íƒ ì‚­ì œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateDeleteButtonOptimized() {
            // Set ê¸°ë°˜ìœ¼ë¡œ ë¹ ë¥¸ ì²´í¬
            deleteSelectedBtn.disabled = checkedMemeIds.size === 0;
            
            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸ (í•„ìš”ì‹œì—ë§Œ)
            const visibleCheckboxes = Array.from(document.querySelectorAll('.meme-checkbox')).filter(checkbox => 
                checkbox.closest('tr').style.display !== 'none'
            );
            
            // ë³´ì´ëŠ” ì²´í¬ë°•ìŠ¤ë“¤ ì¤‘ ì„ íƒëœ ê²ƒë“¤ì˜ ê°œìˆ˜
            let checkedVisibleCount = 0;
            visibleCheckboxes.forEach(checkbox => {
                if (checkedMemeIds.has(checkbox.value)) {
                    checkedVisibleCount++;
                }
            });
            
            if (checkedVisibleCount === 0) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = false;
            } else if (checkedVisibleCount === visibleCheckboxes.length) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = true;
            } else {
                selectAllCheckbox.indeterminate = true;
            }
        }
        
        // ë””ë°”ìš´ì‹±ëœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        const debouncedUpdateDeleteButton = debounce(updateDeleteButtonOptimized, 50);
        
        // ì „ì—­ í•¨ìˆ˜ (ê¸°ì¡´ HTML onchangeì™€ì˜ í˜¸í™˜ì„±)
        window.updateDeleteButton = debouncedUpdateDeleteButton;
        
        // ìµœì í™”ëœ ì„ íƒ ì‚­ì œ ë²„íŠ¼ í´ë¦­
        deleteSelectedBtn.addEventListener('click', function() {
            const selectedIds = Array.from(checkedMemeIds);
            
            if (selectedIds.length === 0) {
                alert('ì‚­ì œí•  ë°ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!confirm(`ì„ íƒí•œ ${selectedIds.length}ê°œì˜ ë°ˆì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            selectedMemeIds.value = selectedIds.join(',');
            deleteMultipleForm.submit();
        });
        
        // í•„í„°ë§ í›„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        const originalFilterMemes = filterMemes;
        filterMemes = function() {
            originalFilterMemes();
            updateDeleteButtonOptimized();
        };
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìƒíƒœ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            // ê¸°ì¡´ì— ì²´í¬ëœ ì²´í¬ë°•ìŠ¤ë“¤ì„ Setì— ì¶”ê°€ (ìƒˆë¡œê³ ì¹¨ ë“±ì˜ ê²½ìš°)
            document.querySelectorAll('.meme-checkbox:checked').forEach(checkbox => {
                checkedMemeIds.add(checkbox.value);
            });
            updateDeleteButtonOptimized();
        });
        
        // ë°ˆ ìŠ¹ì¸ í•¨ìˆ˜
        function approveMeme(memeId) {
            if (!confirm('ì´ ë°ˆì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ìŠ¹ì¸í•˜ë©´ ì „ì²´ ì‚¬ìš©ìì—ê²Œ ê³µê°œë©ë‹ˆë‹¤.')) {
                return;
            }
            
            const button = event.target;
            const originalText = button.textContent;
            button.disabled = true;
            button.textContent = 'ì²˜ë¦¬ì¤‘...';
            
            fetch(`/admin/memes/${memeId}/approve`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.text())
            .then(data => {
                alert(data);
                if (data.includes('ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤')) {
                    location.reload();
                } else {
                    button.disabled = false;
                    button.textContent = originalText;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                button.disabled = false;
                button.textContent = originalText;
            });
        }
        
        // ë°ˆ ë°˜ë ¤ í•¨ìˆ˜
        function rejectMeme(memeId) {
            if (!confirm('ì´ ë°ˆì„ ê²€í† ëŒ€ê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            const button = event.target;
            const originalText = button.textContent;
            button.disabled = true;
            button.textContent = 'ì²˜ë¦¬ì¤‘...';
            
            fetch(`/admin/memes/${memeId}/reject`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.text())
            .then(data => {
                alert(data);
                if (data.includes('ë°˜ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤')) {
                    location.reload();
                } else {
                    button.disabled = false;
                    button.textContent = originalText;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                button.disabled = false;
                button.textContent = originalText;
            });
        }
        
        // ìŠ¹ì¸ ìƒíƒœ í† ê¸€ í•¨ìˆ˜
        function toggleApprovalFilter() {
            const checkbox = document.getElementById('approvalFilter');
            const isChecked = checkbox.checked;
            const url = new URL(window.location);
            
            // ëª…ì‹œì ìœ¼ë¡œ true/false ê°’ì„ ì„¤ì •
            url.searchParams.set('showApprovedOnly', isChecked ? 'true' : 'false');
            
            // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ í•„í„° ì ìš©
            window.location.href = url.toString();
        }
    </script>
</body>
</html>
